<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: LibCYAML: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">LibCYAML: Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document is intended for C developers wishing to make use of <a href="https://github.com/tlsa/libcyaml">LibCYAML</a>.</p>
<h2>Overview </h2>
<p>If you want to use LibCYAML you'll need to have two things:</p>
<ol type="1">
<li>A consistent structure to the sort of YAML you want to load/save.</li>
<li>Some C data structure to load/save to/from.</li>
</ol>
<p>LibCYAML's aim is to make this as simple as possible for the programmer. However, LibCYAML knows nothing about either your data structure or the "shape" of the YAML you want to load. You provide this information by defining "schemas", and passing them to LibCYAML.</p>
<blockquote class="doxtable">
<p><b>Note</b>: If you need to handle arbitrary "free-form" YAML (e.g. for a tool to convert between YAML and JSON), then LibCYAML would not be much help. In such a case, I'd recommend using <a href="https://github.com/yaml/libyaml">libyaml</a> directly. </p>
</blockquote>
<h2>A simple example: loading YAML </h2>
<p>Let's say you want to load the following YAML document:</p>
<div class="fragment"><div class="line">name: Fibonacci</div><div class="line">data:</div><div class="line">  - 1</div><div class="line">  - 1</div><div class="line">  - 2</div><div class="line">  - 3</div><div class="line">  - 5</div><div class="line">  - 8</div></div><!-- fragment --><p>And you want to load it into the following C data structure:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>numbers {</div><div class="line">    <span class="keywordtype">char</span> *name;</div><div class="line">    <span class="keywordtype">int</span> *data;</div><div class="line">    <span class="keywordtype">unsigned</span> data_count;</div><div class="line">};</div></div><!-- fragment --><p>Then we need to define a CYAML schema to describe these to LibCYAML.</p>
<blockquote class="doxtable">
<p><b>Note</b>: Use the doxygen API documentation, or else the documentation in <a href="https://github.com/tlsa/libcyaml/blob/master/include/cyaml/cyaml.h">cyaml.h</a> in conjunction with this guide. </p>
</blockquote>
<p>At the top level of the YAML is a mapping with two fields, "name" and "data". The the first field is just a simple scalar value (it's neither a mapping nor a sequence). The second field has a sequence value.</p>
<p>We'll start by defining the CYAML schema for the "data" sequence, since since that's the "deepest" non-scalar type. The reason for starting here will become clear later.</p>
<div class="fragment"><div class="line"><span class="comment">/* CYAML value schema for entries of the data sequence. */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> cyaml_schema_value_t data_entry = {</div><div class="line">    CYAML_VALUE_INT(CYAML_FLAG_DEFAULT, <span class="keywordtype">int</span>),</div><div class="line">};</div></div><!-- fragment --><p>Here we're making a <code>cyaml_schema_value_t</code> for the entries in the sequence. There are various <code>CYAML_VALUE_{TYPE}</code> macros to assist with this. Here we're using <code>CYAML_VALUE_INT</code>, because the value is a signed integer. The parameters passed to the macro are <code>enum cyaml_flag</code>, and the C data type of the value.</p>
<p>Now we can write the schema for the mapping. First we'll construct an array of <code>cyaml_schema_field_t</code> entries that describe each field in the mapping.</p>
<div class="fragment"><div class="line"><span class="comment">/* CYAML mapping schema fields array for the top level mapping. */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> cyaml_schema_field_t top_mapping_schema[] = {</div><div class="line">    CYAML_FIELD_STRING_PTR(<span class="stringliteral">&quot;name&quot;</span>, CYAML_FLAG_POINTER,</div><div class="line">            <span class="keyword">struct</span> numbers, name,</div><div class="line">            0, CYAML_UNLIMITED),</div><div class="line">    CYAML_FIELD_SEQUENCE(<span class="stringliteral">&quot;data&quot;</span>, CYAML_FLAG_POINTER,</div><div class="line">            <span class="keyword">struct</span> numbers, data, &amp;data_entry,</div><div class="line">            0, CYAML_UNLIMITED),</div><div class="line">    CYAML_FIELD_END</div><div class="line">};</div></div><!-- fragment --><p>There are <code>CYAML_FIELD_{TYPE}</code> helper macros to construct the mapping field entries. The array must be terminated by a <code>CYAML_FIELD_END</code> entry. The helper macro parameters are specific to each <code>CYAML_FIELD_{TYPE}</code> macro.</p>
<p>The entry for the name field is of type string pointer. You can consult the documentation for the <code>CYAML_FIELD_{TYPE}</code> macros to see what the parameters mean.</p>
<blockquote class="doxtable">
<p><b>Note</b>: The field for the sequence takes a pointer to the sequence entry data type that we defined earlier as <code>data_entry</code>. </p>
</blockquote>
<p>Finally we can define the schema for the top level value that gets passed to the LibCYAML.</p>
<div class="fragment"><div class="line"><span class="comment">/* CYAML value schema for the top level mapping. */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> cyaml_schema_value_t top_schema = {</div><div class="line">    CYAML_VALUE_MAPPING(CYAML_FLAG_POINTER,</div><div class="line">            <span class="keyword">struct</span> numbers, top_mapping_schema),</div><div class="line">};</div></div><!-- fragment --><p>In this case our top level value is a mapping type. One of the parameters needed for mappings is the array of field definitions. In this case we're passing the <code>top_mapping_schema</code> that we defined above.</p>
<div class="fragment"><div class="line"><span class="comment">/* Create our CYAML configuration. */</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> cyaml_config_t config = {</div><div class="line">    .log_level = CYAML_LOG_WARNING, <span class="comment">/* Logging errors and warnings only. */</span></div><div class="line">    .log_fn = cyaml_log,            <span class="comment">/* Use the default logging function. */</span></div><div class="line">    .mem_fn = cyaml_mem,            <span class="comment">/* Use the default memory allocator. */</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">/* Where to store the loaded data */</span></div><div class="line"><span class="keyword">struct </span>numbers *n;</div><div class="line"></div><div class="line"><span class="comment">/* Load the file into p */</span></div><div class="line">cyaml_err_t err = cyaml_load_file(argv[ARG_PATH_IN], &amp;config,</div><div class="line">        &amp;top_schema, (cyaml_data_t **)&amp;n, NULL);</div><div class="line"><span class="keywordflow">if</span> (err != CYAML_OK) {</div><div class="line">    <span class="comment">/* Handle error */</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Use the data. */</span></div><div class="line">printf(<span class="stringliteral">&quot;%s:\n&quot;</span>, n-&gt;name);</div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; n-&gt;data_count; i++) {</div><div class="line">    printf(<span class="stringliteral">&quot;  - %i\n&quot;</span>, n-&gt;data[i]);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/* Free the data */</span></div><div class="line">err = cyaml_free(&amp;config, &amp;top_schema, n, 0);</div><div class="line"><span class="keywordflow">if</span> (err != CYAML_OK) {</div><div class="line">    <span class="comment">/* Handle error */</span></div><div class="line">}</div></div><!-- fragment --><p>And that's it, the YAML is loaded into the custom C data structure.</p>
<p>You can find the code for this in the project's <a href="../examples">examples</a> directory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
